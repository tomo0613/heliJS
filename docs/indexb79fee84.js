import{H as V,B as A,V as u,a as x,C as U,Q as G,W as N,S as Q,c as Y}from"./vendor/cannon-cb643ea7.js";import{O as _,V as P,G as Z,I as J,c as X,d as ee,e as te,W as ne,A as oe,D as re,f as ae,M as ie}from"./vendor/three-1570321e.js";const se=function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))o(n);new MutationObserver(n=>{for(const i of n)if(i.type==="childList")for(const a of i.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&o(a)}).observe(document,{childList:!0,subtree:!0});function r(n){const i={};return n.integrity&&(i.integrity=n.integrity),n.referrerpolicy&&(i.referrerPolicy=n.referrerpolicy),n.crossorigin==="use-credentials"?i.credentials="include":n.crossorigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function o(n){if(n.ep)return;n.ep=!0;const i=r(n);fetch(n.href,i)}};se();const L={modelMass:10,rotorBladeLength:2.6,rotorBladeThickness:.05,rotorBladeWidth:.2};var D=function(){return{terrain:t(),heli:r()};function t(){const o=[[10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10],[10,10,8,8,8,8,6,6,6,6,8,8,8,10,10,10],[10,8,6,6,4,0,0,0,0,2,4,6,8,8,10,10],[10,6,6,4,2,0,0,0,0,0,2,4,6,8,8,10],[6,4,0,0,0,0,0,0,0,0,0,2,4,6,8,10],[0,0,0,0,0,0,0,0,0,0,0,0,2,4,6,8],[0,0,0,0,0,0,0,0,0,0,0,0,0,2,4,6],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,4],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,5,5,0],[0,.5,1,.5,0,0,0,0,0,0,0,0,5,0,0,0],[0,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0],[0,2,1,.5,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]],n=o.length,i=o[0].length,a=new V(o,{elementSize:10}),l=new A({mass:0,shape:a});return l.quaternion.setFromAxisAngle(new u(1,0,0),-Math.PI/2),l.position.set(-n*a.elementSize/2,0,i*a.elementSize/2),l}function r(){const o=new A({mass:L.modelMass}),n=new x(new u(.1,.1,1.8)),i=new x(new u(1,1,2)),a=new x(new u(.2,.2,2)),l=new x(new u(.1,1,.2)),c=new x(new u(1.3,.1,.2)),d=new U(L.rotorBladeLength*2,L.rotorBladeLength*2,L.rotorBladeThickness*2,10),w=new G;return w.setFromAxisAngle(new u(0,1,0),Math.PI/2),o.addShape(n,new u(1.2,-1.9,-.7)).addShape(n,new u(-1.2,-1.9,-.7)).addShape(i,new u(0,0,0)).addShape(a,new u(0,.5,3.8)).addShape(l,new u(0,.5,6.1)).addShape(c,new u(0,1.9,6.5)).addShape(d,new u(0,1.5,0),w),o}}(),f;(function(e){e.chase="chase",e.orbit="orbit",e.static="static"})(f||(f={}));const B=[f.chase,f.orbit,f.static];var ce=(e,t)=>{const r=new _(e,t);r.enabled=!1,r.minDistance=10,new P;const o=new P(0,5,20),n=new P,i=.2;let a=f.chase,l,c=w;function d(m){c(m)}function w(m){const k=1-i**m;n.copy(o),n.applyQuaternion(l.quaternion),n.add(l.position),e.position.lerp(n,k),e.lookAt(l.position)}function s(){}function v(){e.lookAt(l.position)}function p(m){l=m}function g(){const k=B.indexOf(a)+1,j=B.length>k?k:0;return B[j]}function $(m=g()){switch(m){case f.chase:console.info("Chase camera"),c=w;break;case f.orbit:console.info("Orbit camera (use mouse to control)"),c=s;break;case f.static:console.info("Static camera"),c=v;break}a=m}return{update:d,setCameraTarget:p,switchCameraMode:$}},y={timeStep:1/60,gravity:{x:0,y:-9.80665,z:0},maxTorque:200,power:1};function de(){const e=document.createElement("aside"),t=document.createElement("section"),r=document.createElement("section");t.setAttribute("id","torqueBar"),e.setAttribute("id","hud"),e.appendChild(t),e.appendChild(r);function o(n){t.style.width=`${y.maxTorque-n.torque}px`,r.textContent=`alt: ${(n.altitude-1).toFixed(1)}`}return{update:o,domElement:e}}const h={increaseTorque:"Space",decreaseTorque:"Slash",pitchForward:"KeyW",pitchBack:"KeyS",rollLeft:"KeyA",rollRight:"KeyD",yawLeft:"KeyQ",yawRight:"KeyE"};Object.defineProperty(window,"controls",{get(){return h}});var q=(()=>{const e=new Set,t=s=>e.has(s);let r=0,o=0,n=0,i=0,a=0,l=0,c=0;window.onkeydown=s=>{e.add(s.code),le(s)},window.onkeyup=s=>{e.delete(s.code)};const d={increaseTorque:()=>{r=Math.min(r+y.power,y.maxTorque)},decreaseTorque:()=>{r=Math.max(r-y.power,0)},setPitch:s=>{o=s*Math.min(r/100,1)},setRoll:s=>{i=s*Math.min(r/100,1)},setYaw:s=>{l=s*Math.min(r/100,1)}};function w(){if(t(h.increaseTorque)?d.increaseTorque():t(h.decreaseTorque)&&d.decreaseTorque(),t(h.pitchForward)||t(h.pitchBack)){const s=t(h.pitchForward)?-1:1;n=Math.min(n+.05,1),d.setPitch(s*n)}else n=0,d.setPitch(0);if(t(h.rollLeft)||t(h.rollRight)){const s=t(h.rollLeft)?1:-1;a=Math.min(a+.05,1),d.setRoll(s*a)}else a=0,d.setRoll(0);if(t(h.yawLeft)||t(h.yawRight)){const s=t(h.yawLeft)?1:-1;c=Math.min(c+.05,1),d.setYaw(s*c)}else c=0,d.setYaw(0)}return{get torque(){return r},get pitchForce(){return o},get rollForce(){return i},get yawForce(){return l},update:w}})();function le(e){["Space","PageUp","PageDown","End","Home","ArrowLeft","ArrowUp","ArrowRight","ArrowDown"].includes(e.code)&&e.preventDefault()}function E(){}function H(e,t="?"){const r=e.split(".").pop();let o;switch(r){case"jpg":o=new J;break;case"glb":case"gltf":o=new Z;break;default:return Promise.reject(new Error(`unknown resource type [${r}]`))}return new Promise((i,a)=>{const l=d=>{i(d)},c=d=>{console.error(`Failed to load resource: ${e}`),a(d)};o.load(e,l,n,c)});function n({loaded:i,total:a,lengthComputable:l}){const c=l?`${I(a,"k")} kB`:t;console.info(`Loading resource: ${e} (${I(i,"k")} / ${c})`)}}function I(e,t){let r=e;const o=["k","M","G","T"].indexOf(t)+1;for(let n=0;n<o;n++)r/=1024;return r.toFixed(2)}function ue(e,t=1024){return[{x:2,y:1},{x:0,y:1},{x:1,y:0},{x:1,y:2},{x:1,y:1},{x:3,y:1}].map(o);function o({x:n,y:i}){const a=document.createElement("canvas");return a.width=t,a.height=t,a.getContext("2d").drawImage(e,-n*t,-i*t),a}}function pe(e,t=200,r=!1){let o;return(...n)=>{r&&!o&&e(...n),clearTimeout(o),o=window.setTimeout(()=>{r?o=void 0:e(...n)},t)}}let F=!1;const he=new X,S=new N;S.gravity.set(y.gravity.x,y.gravity.y,y.gravity.z);S.broadphase=new Q(S);const C=new ee,T=new te(45,z(),.1,1e3),b=new ne;b.setSize(window.innerWidth,window.innerHeight);document.body.appendChild(b.domElement);const R=ce(T,b.domElement),we=new oe(16777215,.5),O=new re(16118995,.9);O.position.set(-1,.5,-1).normalize();C.add(we);C.add(O);const M={},K=de();document.body.appendChild(K.domElement);ge();function me(e){const t=new ae(ue(e));t.needsUpdate=!0,C.background=t}function fe({scene:e}){const t=D.heli,r=new ie({color:5592405}),o={main:E,tail:E};e.children.forEach(p=>{switch(p.name){case"MainRotor":p.material=r,o.main=g=>{p.rotation.y=g};break;case"TailRotor":p.material=r,o.tail=g=>{p.rotation.x=g};break}}),t.position.set(0,3,0),t.linearDamping=.5,t.angularDamping=.9,C.add(e),S.addBody(t),R.setCameraTarget(e);let n=0;const i=Math.PI/180,a=Math.PI*2,l=p=>{const g=i*p.torque;n=n>a?n-a+g:n+g,o.main(-n),o.tail(-n)},c=new u,d=new u,w=new u(0,-.5,0),s=p=>{c.set(p.pitchForce,p.yawForce,p.rollForce),d.set(0,p.torque,0),t.quaternion.vmult(c,c),t.quaternion.vmult(d,d),t.applyForce(d,w),c.isZero()||t.angularVelocity.copy(c)},v=()=>{e.position.copy(t.position),e.quaternion.copy(t.quaternion)};M.heli={scene:e,methods:{applyControls:s,applyPhysics:v,rotateRotors:l}}}function ge(){S.addBody(D.terrain),Promise.all([H("images/skybox.jpg","398 kB"),H("models/Heli.gltf","164 kB")]).then(([e,t])=>{me(e),fe(t),Y(C,S.bodies),b.setAnimationLoop(W)}).catch(e=>{console.error(e)})}function W(){const e=he.getDelta();b.render(C,T),S.step(y.timeStep,e),ye(),q.update(),K.update({torque:q.torque,altitude:M.heli.scene.position.y}),R.update(e)}function ye(){M.heli.methods.applyControls(q),M.heli.methods.rotateRotors(q),M.heli.methods.applyPhysics()}function z(){return window.innerWidth/window.innerHeight}function be(){T.aspect=z(),T.updateProjectionMatrix(),b.setSize(window.innerWidth,window.innerHeight)}window.onresize=pe(be,500);window.addEventListener("keyup",e=>{e.code==="KeyC"&&R.switchCameraMode(),e.code==="KeyP"&&(F?(F=!1,b.setAnimationLoop(W)):(F=!0,b.setAnimationLoop(null)))});
